---
output: pdf_document
---

\begin{titlepage}
\centering
{\includegraphics[width=0.5\textwidth]{LOGOU.png}\par}
\vspace{1cm}
{\bfseries\LARGE Universidad Nacional De Colombia\par}
\vspace{1cm}
{\bfseries\LARGE Trabajo 1 - Hielos\par}
\vspace{1cm}
{\bfseries\LARGE Modelos no lineales\par}
\vfill
{\Large Autores: \par}
{\Large Sofía Cuartas\\ Santiago Carvajal Torres \par}
\vfill
{\Large Entregado a: \par}
{\Large Juan Carlos Correa Morales \par}
\vfill
{\Large 13 de Septiembre 2023 \par}
\end{titlepage}

\newpage
\tableofcontents

\newpage
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,message = FALSE)
```

```{r}
library(readxl)
library(kableExtra)
library(ggplot2)
library(magrittr)
library(dplyr)
```

\section{Análisis descriptivo}

```{r lectura}
datos <- read_excel("datos.xlsx")

datos_10ml <- datos[which(datos$Valor_inicial=='10'),]
datos_20ml <- datos[which(datos$Valor_inicial=='20'),]
datos_30ml <- datos[which(datos$Valor_inicial=='30'),]

rbind(head(datos,6)) %>%
  kbl(caption = "Primeros datos en la base de datos") %>%
  kable_styling(full_width = FALSE,latex_options = "HOLD_position") %>%
  kable_classic()

```

\subsection{Gráfico de los datos}

```{r}
colores <- c("10" = "blue", "20" = "red","30" = "yellow")

ggplot(datos, aes(x = Tiempo, y = Volumen_derretido, color = as.factor(Valor_inicial))) +
  geom_point() +
  labs(x = "Tiempo", y = "Volumen derretido") +
  ggtitle("Volumen Derretido en Función del Tiempo") +
  scale_color_manual(name = "Valor Inicial", values = colores) +
  guides(color = guide_legend(override.aes = list(shape = 19))) 
```


\section{Modelos}

\subsection{Modelo logístico}

```{r,error=TRUE,echo=TRUE}
modelo_logistico <- nls(Volumen_derretido~SSlogis(Tiempo,Asym,xmid,scal),data = datos_10ml)
```


Dado que la función **nls** ni **Optim** no converge, se hizo con la librería **GenSA**.
```{r}
library(GenSA)
modelo <- function(Tiempo, b0, b1) {
  b0 / ((1 - exp(b1 * Tiempo))^(-1))
}

# Definir la función objetivo para la optimización
objetivo <- function(params) {
  b0 <- params[1]
  b1 <- params[2]
  predicciones <- modelo(datos_10ml$Tiempo, b0, b1)
  error <- sum((datos_10ml$Volumen_derretido - predicciones)^2)
  return(error)
}

# Definir límites para los parámetros
limites <- matrix(c(-100, -100,    # límite inferior para b0 y b1
                    100, 100),  # límite superior para b0 y b1
                  ncol = 2,
                  byrow = TRUE)

# Ejecutar la optimización con GENSA
resultado_optimizacion_logistico <- GenSA(fn = objetivo,
                                lower = limites[1, ],
                                upper = limites[2, ])

# Obtener los valores óptimos de los parámetros
valores_optimos <- resultado_optimizacion_logistico$par

valores_optimos

```

```{r}

modelo_logistico <- data.frame(Volumen = c(20,40,60),predic = NA)

b0 <- -15.509789788
b1 <- 0.007374086

for (i in 1:3) {
  Volumen = c(20,40,60)
  modelo_logistico$predic[i] <- b0 / ((1 - exp(b1 * (Volumen[i])))^(-1))
}


  
datos_10ml %>% ggplot(aes(x=Tiempo, y=Volumen_derretido)) +
  geom_point(colour= "blue")+
  geom_line(data=modelo_logistico,aes(x=Volumen,y=predic))+
  labs(title="Modelo logístico")

```

